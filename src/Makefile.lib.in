LIBS=@LIBS@
OPENSSL=@OPENSSL@
CXXFLAGS = -O0 -g3 -Wall -I. -I../include -I$(OPENSSL)/include $(INCDIR) @DEFS@
LDFLAGS = -L. -L$(OPENSSL)/lib $(LIBS) -lstdc++

OBJS = tqsllib.o openssl_cert.o adif.o

PTARGETS = test_openssl

ifeq ($(WINDOWS),1)
  TARGETS=$(PTARGETS) tqsllib.dll
else
  TARGETS=$(PTARGETS)
endif

SUPPORT_LIB = lotwsup
MYLIB = tqsllib

all: $(TARGETS)

test_openssl$(OBJSUF): test_openssl.o lib$(MYLIB).a
	gcc -o test_openssl$(OBJSUF) test_openssl.o -l$(MYLIB) $(LDFLAGS)
	
include tqsllib.depends

lib$(MYLIB).a: $(OBJS)
	rm -f lib$(MYLIB).a
	ar q lib$(MYLIB).a $(OBJS)
	ranlib lib$(MYLIB).a

tqsllib.dll: lib$(MYLIB).a
	dllwrap.exe --export-all-symbols --dllname tqsllib.dll \
		--output-lib libtqsllibd.a libtqsllib.a -L$(OPENSSL)/lib -lcrypto -lgdi32

%.o: %.cpp
	g++ $(CXXFLAGS) -c -o $@ $*.cpp

%.o: %.c
	gcc $(CXXFLAGS) -c -o $@ $*.c
